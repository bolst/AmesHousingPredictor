<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>House Price Estimator (Plain HTML)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    body { margin: 24px; background:#f7f8fb; color:#0f172a; }
    .container { max-width: 960px; margin: 0 auto; }
    h1 { margin: 0 0 8px; font-size: 28px; }
    .muted { color:#475569; margin-bottom: 20px; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
    .card { background:white; border-radius:14px; padding:16px; box-shadow: 0 6px 18px rgba(2,8,20,0.05); }
    .row { margin: 14px 0; }
    .label { font-size: 13px; color:#475569; display:flex; justify-content:space-between; }
    .val { font-weight:600; color:#0f172a; margin-left:8px; }
    input[type="range"] { width:100%; }
    select, input[type="number"], input[type="text"], button {
      width:100%; padding:10px 12px; border:1px solid #e2e8f0; border-radius:10px; background:white;
      font-size:14px;
    }
    button { background:#111827; color:white; border:none; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .price { font-size: 32px; font-weight:700; letter-spacing: .3px; }
    .small { font-size:12px; color:#64748b; }
    pre { background:#f8fafc; border:1px solid #e2e8f0; padding:10px; border-radius:10px; overflow:auto; }
    @media (max-width: 800px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>House Price Estimator</h1>
    <div class="muted">Use the sliders and dropdowns to describe the home, then click <b>Predict</b>. Set your API URL if your FastAPI server is running.</div>

    <div class="grid">
      <!-- Controls -->
      <div class="card">
        <div class="row">
          <label class="label">Prediction API URL <span class="small">(auto-fills with your local FastAPI)</span></label>
          <input id="apiUrl" type="text" placeholder="http://127.0.0.1:8000/predict" />
        </div>

        <div class="row">
          <label class="label">Overall Quality <span class="val" id="v-OverallQual">7</span></label>
          <input id="OverallQual" type="range" min="1" max="10" step="1" value="7" oninput="updateVal('OverallQual')" />
        </div>

        <div class="row">
          <label class="label">Above-Grade Living Area (sqft)
            <span class="val" id="v-GrLivArea">1710</span>
          </label>
          <input id="GrLivArea" type="range" min="300" max="5000" step="10" value="1710" oninput="updateVal('GrLivArea')" />
        </div>

        <div class="row">
          <label class="label">Total Basement (sqft)
            <span class="val" id="v-TotalBsmtSF">856</span>
          </label>
          <input id="TotalBsmtSF" type="range" min="0" max="3000" step="10" value="856" oninput="updateVal('TotalBsmtSF')" />
        </div>

        <div class="row">
          <label class="label">Garage Capacity (cars)
            <span class="val" id="v-GarageCars">2</span>
          </label>
          <input id="GarageCars" type="range" min="0" max="4" step="1" value="2" oninput="updateVal('GarageCars')" />
        </div>

        <div class="row">
          <label class="label">Year Built <span class="val" id="v-YearBuilt">2003</span></label>
          <input id="YearBuilt" type="range" min="1872" max="2010" step="1" value="2003" oninput="updateVal('YearBuilt')" />
        </div>

        <div class="row">
          <label class="label">Full Baths <span class="val" id="v-FullBath">2</span></label>
          <input id="FullBath" type="range" min="0" max="4" step="1" value="2" oninput="updateVal('FullBath')" />
        </div>

        <div class="row">
          <label class="label">Half Baths <span class="val" id="v-HalfBath">1</span></label>
          <input id="HalfBath" type="range" min="0" max="4" step="1" value="1" oninput="updateVal('HalfBath')" />
        </div>

        <div class="row">
          <label class="label">Bedrooms Above Grade <span class="val" id="v-BedroomAbvGr">3</span></label>
          <input id="BedroomAbvGr" type="range" min="0" max="8" step="1" value="3" oninput="updateVal('BedroomAbvGr')" />
        </div>

        <div class="row">
          <label class="label">Neighborhood</label>
          <select id="Neighborhood">
            <option>CollgCr</option><option>Veenker</option><option>Crawfor</option><option>NoRidge</option>
            <option>Mitchel</option><option>Somerst</option><option>NWAmes</option><option>OldTown</option>
            <option>BrkSide</option><option>Sawyer</option><option>NridgHt</option><option>NAmes</option>
            <option>SawyerW</option><option>IDOTRR</option><option>MeadowV</option><option>Edwards</option>
            <option>Timber</option><option>Gilbert</option><option>StoneBr</option><option>ClearCr</option>
            <option>NPkVill</option><option>Blmngtn</option><option>BrDale</option><option>SWISU</option>
            <option>Blueste</option>
          </select>
        </div>

        <div class="row">
          <label class="label">Kitchen Quality</label>
          <select id="KitchenQual">
            <option value="Ex">Excellent</option>
            <option value="Gd" selected>Good</option>
            <option value="TA">Typical</option>
            <option value="Fa">Fair</option>
            <option value="Po">Poor</option>
          </select>
        </div>

        <div class="row">
          <label class="label">Central Air</label>
          <select id="CentralAir">
            <option value="Y">Yes</option>
            <option value="N">No</option>
          </select>
        </div>

        <div class="row">
          <label class="label">Sale Condition</label>
          <select id="SaleCondition">
            <option>Normal</option><option>Abnorml</option><option>AdjLand</option><option>Alloca</option>
            <option>Family</option><option>Partial</option>
          </select>
        </div>

        <div class="row">
          <button id="predictBtn">Predict Price</button>
        </div>
      </div>

      <!-- Output -->
      <div class="card">
        <div class="small">Estimated Price</div>
        <div id="price" class="price">—</div>

        <div class="row">
          <div class="small">Request payload</div>
          <pre id="payload">{}</pre>
        </div>

        <div class="row">
          <div class="small">Server response</div>
          <pre id="response">{}</pre>
        </div>
      </div>
    </div>
  </div>

  <script>
    const fmtCurrency = n => n.toLocaleString(undefined, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
    const defaultFeatures = {
      Id: 1,
      MSSubClass: 60,
      MSZoning: 'RL',
      LotFrontage: 65,
      LotArea: 8450,
      Street: 'Pave',
      Alley: null,
      LotShape: 'Reg',
      LandContour: 'Lvl',
      Utilities: 'AllPub',
      LotConfig: 'Inside',
      LandSlope: 'Gtl',
      Neighborhood: 'CollgCr',
      Condition1: 'Norm',
      Condition2: 'Norm',
      BldgType: '1Fam',
      HouseStyle: '2Story',
      OverallQual: 7,
      OverallCond: 5,
      YearBuilt: 2003,
      YearRemodAdd: 2003,
      RoofStyle: 'Gable',
      RoofMatl: 'CompShg',
      Exterior1st: 'VinylSd',
      Exterior2nd: 'VinylSd',
      MasVnrType: 'BrkFace',
      MasVnrArea: 196,
      ExterQual: 'Gd',
      ExterCond: 'TA',
      Foundation: 'PConc',
      BsmtQual: 'Gd',
      BsmtCond: 'TA',
      BsmtExposure: 'No',
      BsmtFinType1: 'GLQ',
      BsmtFinSF1: 706,
      BsmtFinType2: 'Unf',
      BsmtFinSF2: 0,
      BsmtUnfSF: 150,
      TotalBsmtSF: 856,
      Heating: 'GasA',
      HeatingQC: 'Ex',
      CentralAir: 'Y',
      Electrical: 'SBrkr',
      '1stFlrSF': 856,
      '2ndFlrSF': 854,
      LowQualFinSF: 0,
      GrLivArea: 1710,
      BsmtFullBath: 1,
      BsmtHalfBath: 0,
      FullBath: 2,
      HalfBath: 1,
      BedroomAbvGr: 3,
      KitchenAbvGr: 1,
      KitchenQual: 'Gd',
      TotRmsAbvGrd: 8,
      Functional: 'Typ',
      Fireplaces: 0,
      FireplaceQu: null,
      GarageType: 'Attchd',
      GarageYrBlt: 2003,
      GarageFinish: 'RFn',
      GarageCars: 2,
      GarageArea: 548,
      GarageQual: 'TA',
      GarageCond: 'TA',
      PavedDrive: 'Y',
      WoodDeckSF: 0,
      OpenPorchSF: 61,
      EnclosedPorch: 0,
      '3SsnPorch': 0,
      ScreenPorch: 0,
      PoolArea: 0,
      PoolQC: null,
      Fence: null,
      MiscFeature: null,
      MiscVal: 0,
      MoSold: 2,
      YrSold: 2008,
      SaleType: 'WD',
      SaleCondition: 'Normal'
    };

    const apiInput = document.getElementById('apiUrl');
    const DEFAULT_API_URL = "http://127.0.0.1:8000/predict";

    function getFeatures() {
      return {
        ...defaultFeatures,
        OverallQual: Number(document.getElementById('OverallQual').value),
        GrLivArea: Number(document.getElementById('GrLivArea').value),
        TotalBsmtSF: Number(document.getElementById('TotalBsmtSF').value),
        GarageCars: Number(document.getElementById('GarageCars').value),
        YearBuilt: Number(document.getElementById('YearBuilt').value),
        FullBath: Number(document.getElementById('FullBath').value),
        HalfBath: Number(document.getElementById('HalfBath').value),
        BedroomAbvGr: Number(document.getElementById('BedroomAbvGr').value),
        Neighborhood: document.getElementById('Neighborhood').value,
        KitchenQual: document.getElementById('KitchenQual').value,
        CentralAir: document.getElementById('CentralAir').value,
        SaleCondition: document.getElementById('SaleCondition').value
      };
    }

    function updatePayloadPreview() {
      const body = { features: getFeatures() };
      document.getElementById('payload').textContent = JSON.stringify(body, null, 2);
    }

    function updateVal(id) {
      document.getElementById('v-' + id).textContent = document.getElementById(id).value;
      updatePayloadPreview();
    }

    // simple mock if no API URL provided
    function mockPredict(f) {
      const base = 50000;
      const q = 25000 * (f.OverallQual ?? 5);
      const area = 120 * (f.GrLivArea ?? 1500);
      const bsmt = 60 * (f.TotalBsmtSF ?? 800);
      const garage = 8000 * (f.GarageCars ?? 1);
      const baths = 10000 * ((f.FullBath ?? 1) + 0.5 * (f.HalfBath ?? 0));
      const agePenalty = Math.max(0, 2010 - (f.YearBuilt ?? 1990)) * 300;
      const hoodBump = ({NridgHt:90000, NoRidge:80000, StoneBr:85000, Somerst:40000, Gilbert:30000, CollgCr:25000})[f.Neighborhood] || 0;
      const price = base + q + area + bsmt + garage + baths + hoodBump - agePenalty;
      return 1;
    }

    async function predict() {
      const apiUrl = apiInput.value.trim();
      const btn = document.getElementById('predictBtn');
      const priceEl = document.getElementById('price');
      const respEl = document.getElementById('response');
      btn.disabled = true;
      respEl.textContent = '…';

      try {
        const features = getFeatures();
        const body = { features };
        let price;
        if (!apiUrl) {
          // No backend set → use mock
          price = mockPredict(features);
          respEl.textContent = JSON.stringify({ price, used_model: 'mock' }, null, 2);
        } else {
          const res = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
          });
          if (!res.ok) throw new Error('HTTP ' + res.status);
          const data = await res.json();
          respEl.textContent = JSON.stringify(data, null, 2);
          if (typeof data.price === 'number') {
            price = data.price;
          } else if (typeof data.prediction === 'number') {
            price = data.prediction;
          }
        }
        priceEl.textContent = typeof price === 'number' ? fmtCurrency(price) : '—';
      } catch (err) {
        respEl.textContent = 'Error: ' + err.message;
        priceEl.textContent = '—';
      } finally {
        btn.disabled = false;
      }
    }

    document.getElementById('predictBtn').addEventListener('click', predict);
    if (!apiInput.value) apiInput.value = DEFAULT_API_URL;
    apiInput.addEventListener('change', updatePayloadPreview);
    ['Neighborhood','KitchenQual','CentralAir','SaleCondition'].forEach(id => {
      const el = document.getElementById(id);
      el.value = defaultFeatures[id];
      el.addEventListener('change', updatePayloadPreview);
    });
    ['OverallQual','GrLivArea','TotalBsmtSF','GarageCars','YearBuilt','FullBath','HalfBath','BedroomAbvGr']
      .forEach(id => {
        const el = document.getElementById(id);
        el.value = defaultFeatures[id];
        updateVal(id);
      });
  </script>
</body>
</html>
